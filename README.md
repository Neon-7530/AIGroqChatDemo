# 猫の道具屋さんチャットシステム

## 概要
このプログラムは、RPGゲームの道具屋の商人「にゃんすけ」と会話できるチャットシステムです。Unityで作られており、Groq APIというAIサービスを使って会話を実現しています。

## 必要なもの
- Unity 2020.3以降
- Groq APIのAPIキー
- インターネット接続

## 使い方

### 1. セットアップ
1. Unityでプロジェクトを開きます
2. `Assets/Script/GroqAPIClient.cs`を開きます
3. `apiKey`の値を、あなたのGroq APIキーに書き換えます

### 2. ゲームの起動
1. Unityエディタで再生ボタンを押します
2. ゲームが起動すると、自動的にはじめの挨拶が表示されます

### 3. 会話の仕方
1. 画面下部の入力欄にメッセージを入力します
2. 送信ボタンをクリックするか、Enterキーを押します
3. にゃんすけが返事をしてくれます

### 4. 商品の購入
- いい感じの剣（20ルピー）
- そこそこ強い防具（50ルピー）

商品を購入すると、画面に購入履歴が表示されます。

## プログラムの流れ

### 1. 起動時の流れ
```
Start()
↓
InitializeSystemMessage() // にゃんすけの設定を読み込む
↓
SetupEventListeners() // ボタンなどの設定
↓
CallGroqAPI() // 最初の挨拶を表示
```

### 2. メッセージ送信時の流れ

```
OnSendButtonClicked() // 送信ボタンが押された
↓
CallGroqAPI() // APIを呼び出す
↓
CreateAPIRequest() // リクエストを作成
↓
ProcessAPIResponse() // 返事を処理
↓
ProcessAIResponse() // AIの返事を処理
↓
HandleValidResponse() // 画面に表示
```

## 主な機能

### 1. 会話機能
- `AppendMessage()`: メッセージを画面に表示します
- `ProcessAIResponse()`: AIの返事を処理します

### 2. 商品管理
- `purchasedItems`: 購入した商品のリストを保持します
- 商品を購入すると自動的にリストに追加されます

### 3. エラー処理
- `HandleParseError()`: エラーメッセージを表示します
- `HandleAPIError()`: APIのエラーを処理します

## トラブルシューティング

### よくある問題と解決方法

1. エラー「APIリクエストに失敗しました」
   - インターネット接続を確認してください
   - APIキーが正しいか確認してください

2. エラー「レスポンスの処理に失敗しました」
   - プログラムを再起動してください
   - 入力内容を確認してください

## カスタマイズ方法

### 1. 商品の追加
`InitializeSystemMessage()`メソッド内の「売っているもの」の部分を編集します。

### 2. 表示の変更
`AppendMessage()`メソッドを編集して、表示方法を変更できます。

## 注意事項
- APIキーは他人に教えないでください
- インターネット接続が必要です
- 無料枠を超えると課金が発生する可能性があります

## 参考リンク
- [Unity公式サイト](https://unity.com/)
- [Groq API公式サイト](https://groq.com/)

## 開発者向け情報

### ファイル構成
```
Assets/
├── Script/
│ ├── GroqAPIClient.cs # メインのプログラム
│ └── Models/
│ └── ChatModels.cs # データの定義
```


### 主要なクラス
1. `GroqChatClient`: メインのプログラム
   - 会話の管理
   - APIとの通信
   - 画面表示の制御

2. `ChatModels`: データの定義
   - メッセージの形式
   - APIリクエスト/レスポンスの形式

### 拡張のヒント
1. 新しい機能の追加
   - 新しいメソッドを追加する場合は、既存のメソッドを参考にしてください
   - エラー処理を忘れずに実装してください

2. デバッグ方法
   - `Debug.Log()`を使って動作を確認できます
   - Unityのコンソールでエラーメッセージを確認できます